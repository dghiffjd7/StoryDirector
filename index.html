<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Story Weaver - 故事大纲生成器</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- 插件主面板容器 -->
    <div id="story-weaver-panel" class="story-weaver-panel">
      <!-- 面板头部 -->
      <div class="story-weaver-header">
        <h2 class="panel-title">
          <span class="title-icon">📖</span>
          Story Weaver - 故事大纲生成器
        </h2>
        <div class="header-controls">
          <button id="import-preset" class="header-btn" title="导入预设">
            <span>📥</span>
          </button>
          <button id="export-preset" class="header-btn" title="导出预设">
            <span>📤</span>
          </button>
          <button id="minimize-panel" class="header-btn" title="最小化">
            <span>➖</span>
          </button>
          <button id="show-help" class="header-btn" title="使用说明">
            <span>❓</span>
          </button>
          <button id="close-panel" class="close-btn" title="关闭面板">
            <span>✕</span>
          </button>
        </div>
      </div>

      <!-- 面板内容区域 -->
      <div class="story-weaver-content">
        <!-- 剧情上下文设定区 -->
        <section class="content-section">
          <h3 class="section-title">
            <span class="section-icon">📖</span>
            剧情上下文设定
          </h3>
          <div class="section-content">
            <div class="form-group">
              <label for="context-length" class="form-label"> 读取对话历史长度： </label>
              <div class="input-with-unit">
                <input type="number" id="context-length" value="100" min="0" max="500" class="form-input" />
                <span class="input-unit">条消息</span>
              </div>
              <div class="form-help">设置为0则不读取对话历史，仅基于世界观生成</div>
            </div>
            <div id="context-status" class="status-display">
              <span class="status-icon">ℹ️</span>
              将根据设定自动读取最近的对话内容
            </div>
          </div>
        </section>

        <!-- 创作需求设定区 -->
        <section class="content-section">
          <h3 class="section-title">
            <span class="section-icon">✨</span>
            创作需求设定
          </h3>
          <div class="section-content">
            <div class="form-group">
              <label for="story-type" class="form-label">故事类型：</label>
              <select id="story-type" class="form-select">
                <option value="fantasy">🏰 奇幻冒险</option>
                <option value="romance">💖 浪漫爱情</option>
                <option value="mystery">🔍 悬疑推理</option>
                <option value="scifi">🚀 科幻未来</option>
                <option value="slice-of-life">🌸 日常生活</option>
                <option value="action">⚔️ 动作冒险</option>
                <option value="drama">🎭 情感剧情</option>
                <option value="horror">👻 恐怖惊悚</option>
                <option value="comedy">😄 轻松喜剧</option>
                <option value="custom">🎨 自定义</option>
              </select>
            </div>

            <div class="form-group">
              <label for="story-theme" class="form-label"> 故事主题/核心冲突： </label>
              <textarea
                id="story-theme"
                class="form-textarea"
                placeholder="例如：主角需要拯救被诅咒的王国，同时面对内心的恐惧与过去的阴霾。在这个过程中，主角将遇到值得信赖的伙伴，也会面临艰难的道德选择..."
                rows="4"
              ></textarea>
              <div class="form-help">详细描述您希望故事围绕的核心主题、冲突或目标</div>
            </div>

            <div class="form-group">
              <label for="story-style" class="form-label">叙事风格：</label>
              <select id="story-style" class="form-select">
                <option value="descriptive">📝 详细描述型</option>
                <option value="dialogue">💬 对话推进型</option>
                <option value="action">⚡ 快节奏动作型</option>
                <option value="introspective">🤔 内心独白型</option>
                <option value="episodic">📚 章节式结构</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group flex-1">
                <label for="chapter-count" class="form-label"> 期望章节数： </label>
                <input type="number" id="chapter-count" value="5" min="3" max="20" class="form-input" />
              </div>
              <div class="form-group flex-1">
                <label for="detail-level" class="form-label"> 大纲详细程度： </label>
                <select id="detail-level" class="form-select">
                  <option value="brief">简要大纲</option>
                  <option value="detailed" selected>详细大纲</option>
                  <option value="comprehensive">全面大纲</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="special-requirements" class="form-label"> 特殊要求（可选）： </label>
              <textarea
                id="special-requirements"
                class="form-textarea"
                placeholder="例如：需要包含特定角色的发展弧线、某些情节元素、特定的情感基调等..."
                rows="3"
              ></textarea>
            </div>
          </div>
        </section>

        <!-- 提示词预设说明区 -->
        <section class="content-section">
          <details id="preset-info-container">
            <summary class="section-title prompt-summary">
              <span class="section-icon">💾</span>
              预设管理说明
              <span class="summary-arrow">▶</span>
            </summary>
            <div class="section-content">
              <div class="form-help">
                <p><strong>如何使用预设功能：</strong></p>
                <ol>
                  <li><strong>保存当前配置：</strong>在提示词管理器中点击💾保存按钮，输入预设名称即可保存当前的所有配置（包括提示词内容、启用状态、各种设置等）</li>
                  <li><strong>切换预设：</strong>使用提示词管理器中的下拉选单可以快速切换到之前保存的预设</li>
                  <li><strong>管理预设：</strong>点击⚙️按钮可以重命名、删除、导出预设，或查看预设详情</li>
                  <li><strong>自动恢复：</strong>下次打开 SillyTavern 时，会自动加载上次使用的预设配置</li>
                </ol>
                <p><strong>预设包含的内容：</strong>所有提示词内容、启用/禁用状态、注入顺序、故事类型、详细程度、章节数量、各种开关选项等完整配置。</p>
              </div>
            </div>
          </details>
        </section>

        <!-- 生成控制区 -->
        <section class="content-section">
          <div class="generate-section">
            <button id="generate-outline" class="generate-btn">
              <span class="btn-icon">🎭</span>
              <span class="btn-text">生成故事大纲</span>
              <span class="btn-loading hidden">🔄</span>
            </button>
            <div class="generate-options">
              <label class="checkbox-label">
                <input type="checkbox" id="include-summary" checked />
                <span class="checkmark"></span>
                包含整体摘要
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="include-characters" checked />
                <span class="checkmark"></span>
                包含角色发展
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="include-themes" />
                <span class="checkmark"></span>
                包含主题分析
              </label>
            </div>
          </div>
        </section>

        <!-- 生成结果区 -->
        <section id="output-section" class="content-section">
          <h3 class="section-title">
            <span class="section-icon">📄</span>
            生成结果
            <div class="title-actions">
              <button id="generate-details" class="action-btn" title="生成选中章节的细纲">
                <span class="btn-icon">📝</span>
              </button>
              <button id="copy-result" class="action-btn" title="复制到剪贴板">
                <span class="btn-icon">📋</span>
              </button>
              <button id="save-result" class="action-btn" title="保存为文件">
                <span class="btn-icon">💾</span>
              </button>
              <button id="export-result" class="action-btn" title="导出为Markdown">
                <span class="btn-icon">📤</span>
              </button>
            </div>
          </h3>
          <div class="section-content">
            <div id="output-content" class="output-content">
              <div id="output-placeholder" class="output-placeholder">
                <span class="placeholder-icon">📝</span>
                <p>故事大纲将在这里显示...</p>
                <p class="placeholder-help">填写上方信息后点击"生成故事大纲"开始创作</p>
              </div>
              
              <!-- 段落展示容器 -->
              <div id="outline-paragraphs" class="outline-paragraphs hidden">
                <!-- 段落项目将在这里动态生成 -->
              </div>
            </div>
            <div id="output-stats" class="output-stats hidden">
              <div class="stat-item">
                <span class="stat-label">字数统计：</span>
                <span id="word-count" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">生成时间：</span>
                <span id="generation-time" class="stat-value">--</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">章节数量：</span>
                <span id="actual-chapters" class="stat-value">0</span>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- 加载指示器 -->
    <div id="loading-overlay" class="loading-overlay hidden">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>正在生成故事大纲...</p>
      </div>
    </div>

    <!-- 通知容器 -->
    <div id="notification-container" class="notification-container"></div>

    <!-- 悬浮小精灵 -->
    <div id="story-weaver-sprite" class="story-weaver-sprite" title="打开Story Weaver">
      <span>📖</span>
    </div>

    <!-- 脚本加载 -->
    <script src="script.js"></script>
  </body>
</html>
